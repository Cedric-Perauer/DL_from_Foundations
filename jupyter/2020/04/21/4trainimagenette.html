<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Fastai Course DL from the Foundations Train on Imagenette | fastpages</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Fastai Course DL from the Foundations Train on Imagenette" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Imagenette and Training our classifier (Lesson 5 Part 3)" />
<meta property="og:description" content="Imagenette and Training our classifier (Lesson 5 Part 3)" />
<link rel="canonical" href="https://cedric-perauer.github.io/DL_from_Foundations/jupyter/2020/04/21/4trainimagenette.html" />
<meta property="og:url" content="https://cedric-perauer.github.io/DL_from_Foundations/jupyter/2020/04/21/4trainimagenette.html" />
<meta property="og:site_name" content="fastpages" />
<meta property="og:image" content="https://cedric-perauer.github.io/DL_from_Foundations/images/logo.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-04-21T00:00:00-05:00" />
<script type="application/ld+json">
{"datePublished":"2020-04-21T00:00:00-05:00","image":"https://cedric-perauer.github.io/DL_from_Foundations/images/logo.png","description":"Imagenette and Training our classifier (Lesson 5 Part 3)","mainEntityOfPage":{"@type":"WebPage","@id":"https://cedric-perauer.github.io/DL_from_Foundations/jupyter/2020/04/21/4trainimagenette.html"},"@type":"BlogPosting","url":"https://cedric-perauer.github.io/DL_from_Foundations/jupyter/2020/04/21/4trainimagenette.html","headline":"Fastai Course DL from the Foundations Train on Imagenette","dateModified":"2020-04-21T00:00:00-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/DL_from_Foundations/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://cedric-perauer.github.io/DL_from_Foundations/feed.xml" title="fastpages" /><link rel="shortcut icon" type="image/x-icon" href="/DL_from_Foundations/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Fastai Course DL from the Foundations Train on Imagenette | fastpages</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Fastai Course DL from the Foundations Train on Imagenette" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Imagenette and Training our classifier (Lesson 5 Part 3)" />
<meta property="og:description" content="Imagenette and Training our classifier (Lesson 5 Part 3)" />
<link rel="canonical" href="https://cedric-perauer.github.io/DL_from_Foundations/jupyter/2020/04/21/4trainimagenette.html" />
<meta property="og:url" content="https://cedric-perauer.github.io/DL_from_Foundations/jupyter/2020/04/21/4trainimagenette.html" />
<meta property="og:site_name" content="fastpages" />
<meta property="og:image" content="https://cedric-perauer.github.io/DL_from_Foundations/images/logo.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-04-21T00:00:00-05:00" />
<script type="application/ld+json">
{"datePublished":"2020-04-21T00:00:00-05:00","image":"https://cedric-perauer.github.io/DL_from_Foundations/images/logo.png","description":"Imagenette and Training our classifier (Lesson 5 Part 3)","mainEntityOfPage":{"@type":"WebPage","@id":"https://cedric-perauer.github.io/DL_from_Foundations/jupyter/2020/04/21/4trainimagenette.html"},"@type":"BlogPosting","url":"https://cedric-perauer.github.io/DL_from_Foundations/jupyter/2020/04/21/4trainimagenette.html","headline":"Fastai Course DL from the Foundations Train on Imagenette","dateModified":"2020-04-21T00:00:00-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://cedric-perauer.github.io/DL_from_Foundations/feed.xml" title="fastpages" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/DL_from_Foundations/">fastpages</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/DL_from_Foundations/search/">Search</a><a class="page-link" href="/DL_from_Foundations/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Fastai Course DL from the Foundations Train on Imagenette</h1><p class="page-description">Imagenette and Training our classifier (Lesson 5 Part 3)</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-04-21T00:00:00-05:00" itemprop="datePublished">
        Apr 21, 2020
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      5 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/DL_from_Foundations/categories/#jupyter">jupyter</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/Cedric-Perauer/DL_from_Foundations/tree/master/_notebooks/2020-04-21-4trainimagenette.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/DL_from_Foundations/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/Cedric-Perauer/DL_from_Foundations/master?filepath=_notebooks%2F2020-04-21-4trainimagenette.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/DL_from_Foundations/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/Cedric-Perauer/DL_from_Foundations/blob/master/_notebooks/2020-04-21-4trainimagenette.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/DL_from_Foundations/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#Fastai-Imagenet(te)-training">Fastai Imagenet(te) training </a></li>
<li class="toc-entry toc-h2"><a href="#XResNet">XResNet </a>
<ul>
<li class="toc-entry toc-h3"><a href="#ResBlock-Details">ResBlock Details </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Train">Train </a></li>
<li class="toc-entry toc-h2"><a href="#cnn_learner">cnn_learner </a></li>
<li class="toc-entry toc-h2"><a href="#Imagenet">Imagenet </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-04-21-4trainimagenette.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Fastai-Imagenet(te)-training">
<a class="anchor" href="#Fastai-Imagenet(te)-training" aria-hidden="true"><span class="octicon octicon-link"></span></a>Fastai Imagenet(te) training<a class="anchor-link" href="#Fastai-Imagenet(te)-training"> </a>
</h2>
<p>FP16 should allow 2x speed ups in theory, practicaly it also depends on the number of fp16 vs fp32 cores on your GPU.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse</span>
<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The autoreload extension is already loaded. To reload it, use:
  %reload_ext autoreload
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse</span>

<span class="kn">from</span> <span class="nn">exp.nb_10c</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://course.fast.ai/videos/?lesson=12&amp;t=1681">Jump_to lesson 12 video</a></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"/media/cedric/Datasets/imagenette2-160/"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">size</span> <span class="o">=</span> <span class="mi">128</span> 
<span class="n">tfms</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_rgb</span><span class="p">,</span> <span class="n">RandomResizedCrop</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="p">(</span><span class="mf">0.35</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span><span class="n">np_to_float</span><span class="p">,</span><span class="n">PilRandomFlip</span><span class="p">()]</span>

<span class="n">bs</span> <span class="o">=</span> <span class="mi">64</span>

<span class="n">il</span> <span class="o">=</span> <span class="n">ImageList</span><span class="o">.</span><span class="n">from_files</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">tfms</span><span class="o">=</span><span class="n">tfms</span><span class="p">)</span>
<span class="n">sd</span> <span class="o">=</span> <span class="n">SplitData</span><span class="o">.</span><span class="n">split_by_func</span><span class="p">(</span><span class="n">il</span><span class="p">,</span><span class="n">partial</span><span class="p">(</span><span class="n">grandparent_splitter</span><span class="p">,</span><span class="n">valid_name</span><span class="o">=</span><span class="s1">'val'</span><span class="p">))</span>
<span class="n">ll</span> <span class="o">=</span> <span class="n">label_by_func</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span><span class="n">parent_labeler</span><span class="p">,</span><span class="n">proc_y</span><span class="o">=</span><span class="n">CategoryProcessor</span><span class="p">())</span>

<span class="n">ll</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">tfms</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_rgb</span><span class="p">,</span><span class="n">CenterCrop</span><span class="p">(</span><span class="n">size</span><span class="p">),</span><span class="n">np_to_float</span><span class="p">]</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">to_databunch</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span><span class="n">c_in</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">c_out</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">num_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="XResNet">
<a class="anchor" href="#XResNet" aria-hidden="true"><span class="octicon octicon-link"></span></a>XResNet<a class="anchor-link" href="#XResNet"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://course.fast.ai/videos/?lesson=12&amp;t=1701">Jump_to lesson 12 video</a></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_show</span>
<span class="k">def</span> <span class="nf">pass_through</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span>

<span class="k">class</span> <span class="nc">Flatten</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span> 
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">conv</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span><span class="n">cout</span><span class="p">,</span><span class="n">ks</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span><span class="n">cout</span><span class="p">,</span><span class="n">kernel_size</span><span class="o">=</span><span class="n">ks</span><span class="p">,</span><span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="n">ks</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="n">bias</span><span class="o">=</span><span class="n">bias</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_show</span>
<span class="n">activation</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">init_cnn</span><span class="p">(</span><span class="n">m</span><span class="p">):</span> 
    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="s1">'bias'</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,(</span><span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">,</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">)):</span> <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">kaiming_normal_</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">children</span><span class="p">():</span> <span class="n">init_cnn</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">conv_layer</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span><span class="n">cout</span><span class="p">,</span><span class="n">ks</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zero_bn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">act</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">bn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">cout</span><span class="p">)</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">constant_</span><span class="p">(</span><span class="n">bn</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span><span class="mf">0.</span> <span class="k">if</span> <span class="n">zero_bn</span> <span class="k">else</span> <span class="mf">1.</span><span class="p">)</span>
    <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">conv</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span><span class="n">cout</span><span class="p">,</span><span class="n">ks</span><span class="p">,</span><span class="n">stride</span><span class="p">),</span><span class="n">bn</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">act</span> <span class="p">:</span> <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">activation</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="n">layers</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_show</span>
<span class="k">class</span> <span class="nc">ResBlock</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">expansion</span><span class="p">,</span><span class="n">ni</span><span class="p">,</span><span class="n">nh</span><span class="p">,</span><span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="n">nf</span><span class="p">,</span><span class="n">ni</span> <span class="o">=</span> <span class="n">nh</span><span class="o">*</span><span class="n">expansion</span><span class="p">,</span><span class="n">ni</span><span class="o">*</span><span class="n">expansion</span>
        <span class="c1">#layers</span>
        <span class="c1">#smaller nets</span>
        <span class="k">if</span> <span class="n">expansion</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span> 
                <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">conv_layer</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span><span class="n">nh</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">),</span> 
                     <span class="n">conv_layer</span><span class="p">(</span><span class="n">nh</span><span class="p">,</span><span class="n">nf</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">zero_bn</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">act</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
        <span class="c1">#larger Nets ResNet-D Path A</span>
        <span class="k">else</span> <span class="p">:</span> 
                <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">conv_layer</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span><span class="n">nh</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> 
                          <span class="n">conv_layer</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span><span class="n">nh</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">),</span>
                          <span class="n">conv_layer</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span><span class="n">nf</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">zero_bn</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">act</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">convs</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="n">layers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idconv</span> <span class="o">=</span> <span class="n">noop</span> <span class="k">if</span> <span class="n">ni</span> <span class="o">==</span> <span class="n">nf</span> <span class="k">else</span> <span class="n">conv_layer</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span><span class="n">nf</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">act</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pool</span> <span class="o">=</span> <span class="n">noop</span> <span class="k">if</span> <span class="n">stride</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">nn</span><span class="o">.</span><span class="n">AvgPool2d</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">ceil_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">act_fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">idconv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
        
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="ResBlock-Details">
<a class="anchor" href="#ResBlock-Details" aria-hidden="true"><span class="octicon octicon-link"></span></a>ResBlock Details<a class="anchor-link" href="#ResBlock-Details"> </a>
</h3>
<p>Batch Norm sometimes has weights of 0 and sometimes 1 during init. It allows us to init the Conv branch to 0 and the identity mapping to 1. The gradient won't explode that way. 
ResNet 50 and onwards use 3 convs, smaller ones use 2. They also use Bottleneck layers (64 filters-&gt; 16filters -&gt; 64 filters), the normal block for larger ResNets. ResNet-D also uses downsample to make sure the two branches can be added. So when stride is not 1, and AvgPool layer with stride of 2 is deployed for different grid size, and 1x1 conv to change the number of filters (if not equal). 
<img src="/DL_from_Foundations/images/copied_from_nb/images/resnetd.png" alt="images"></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_show </span>
<span class="k">class</span> <span class="nc">XResNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">):</span>
    <span class="nd">@classmethod</span> 
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">expansion</span><span class="p">,</span><span class="n">layers</span><span class="p">,</span><span class="n">c_in</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="n">c_out</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span> 
        <span class="n">nfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_in</span><span class="p">,(</span><span class="n">c_in</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">64</span><span class="p">]</span>
        <span class="n">stem</span> <span class="o">=</span> <span class="p">[</span><span class="n">conv_layer</span><span class="p">(</span><span class="n">nfs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">nfs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">stride</span><span class="o">=</span><span class="mi">2</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
               <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
        <span class="n">nfs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">64</span><span class="o">//</span><span class="n">expansion</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">256</span><span class="p">,</span><span class="mi">512</span><span class="p">]</span>
        <span class="n">res_layers</span> <span class="o">=</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">_make_layer</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span><span class="n">nfs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">nfs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span>
                                     <span class="n">n_blocks</span><span class="o">=</span><span class="n">l</span><span class="p">,</span><span class="n">stride</span><span class="o">=</span><span class="mi">1</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="mi">2</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">layers</span><span class="p">)]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">*</span><span class="n">stem</span><span class="p">,</span><span class="n">nn</span><span class="o">.</span><span class="n">MaxPool2d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="o">*</span><span class="n">res_layers</span><span class="p">,</span>
                  <span class="n">nn</span><span class="o">.</span><span class="n">AdaptiveAvgPool2d</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">Flatten</span><span class="p">(),</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">nfs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">expansion</span><span class="p">,</span><span class="n">c_out</span><span class="p">))</span>
        <span class="n">init_cnn</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_make_layer</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span><span class="n">ni</span><span class="p">,</span><span class="n">nf</span><span class="p">,</span><span class="n">n_blocks</span><span class="p">,</span><span class="n">stride</span><span class="p">):</span> 
        <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">ResBlock</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span><span class="n">ni</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span>  <span class="n">nf</span><span class="p">,</span><span class="n">nf</span><span class="p">,</span><span class="n">stride</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span> 
                              <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">)])</span>
        
        
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_show</span>
<span class="k">def</span> <span class="nf">xresnet18</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="n">XResNet</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">xresnet34</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="n">XResNet</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">xresnet50</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="n">XResNet</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">xresnet101</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="n">XResNet</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">xresnet152</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="n">XResNet</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Train">
<a class="anchor" href="#Train" aria-hidden="true"><span class="octicon octicon-link"></span></a>Train<a class="anchor-link" href="#Train"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://course.fast.ai/videos/?lesson=12&amp;t=2515">Jump_to lesson 12 video</a></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_show</span>
<span class="n">cbfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">partial</span><span class="p">(</span><span class="n">AvgStatsCallback</span><span class="p">,</span><span class="n">accuracy</span><span class="p">),</span> <span class="n">ProgressCallback</span><span class="p">,</span> <span class="n">CudaCallback</span><span class="p">,</span>
        <span class="n">partial</span><span class="p">(</span><span class="n">BatchTransformXCallback</span><span class="p">,</span> <span class="n">norm_imagenette</span><span class="p">),</span>
<span class="c1">#         partial(MixUp, alpha=0.2)</span>
       <span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_show</span>
<span class="n">loss_func</span> <span class="o">=</span> <span class="n">LabelSmoothingCrossEntropy</span><span class="p">()</span>
<span class="n">arch</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">xresnet18</span><span class="p">,</span> <span class="n">c_out</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">opt_func</span> <span class="o">=</span> <span class="n">adam_opt</span><span class="p">(</span><span class="n">mom</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">mom_sqr</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">wd</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_show</span>
<span class="k">def</span> <span class="nf">get_batch</span><span class="p">(</span><span class="n">dl</span><span class="p">,</span> <span class="n">learn</span><span class="p">):</span>
    <span class="n">learn</span><span class="o">.</span><span class="n">xb</span><span class="p">,</span><span class="n">learn</span><span class="o">.</span><span class="n">yb</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">dl</span><span class="p">))</span>
    <span class="n">learn</span><span class="o">.</span><span class="n">do_begin_fit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">learn</span><span class="p">(</span><span class="s1">'begin_batch'</span><span class="p">)</span>
    <span class="n">learn</span><span class="p">(</span><span class="s1">'after_fit'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">learn</span><span class="o">.</span><span class="n">xb</span><span class="p">,</span><span class="n">learn</span><span class="o">.</span><span class="n">yb</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We need to replace the old <code>model_summary</code> since it used to take a <code>Runner</code>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_show</span>
<span class="k">def</span> <span class="nf">model_summary</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">find_all</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">print_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">xb</span><span class="p">,</span><span class="n">yb</span> <span class="o">=</span> <span class="n">get_batch</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">valid_dl</span><span class="p">,</span> <span class="n">learn</span><span class="p">)</span>
    <span class="n">mods</span> <span class="o">=</span> <span class="n">find_modules</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">is_lin_layer</span><span class="p">)</span> <span class="k">if</span> <span class="n">find_all</span> <span class="k">else</span> <span class="n">model</span><span class="o">.</span><span class="n">children</span><span class="p">()</span>
    <span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">hook</span><span class="p">,</span><span class="n">mod</span><span class="p">,</span><span class="n">inp</span><span class="p">,</span><span class="n">out</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"====</span><span class="se">\n</span><span class="si">{</span><span class="n">mod</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span> <span class="k">if</span> <span class="n">print_mod</span> <span class="k">else</span> <span class="s2">""</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">Hooks</span><span class="p">(</span><span class="n">mods</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">as</span> <span class="n">hooks</span><span class="p">:</span> <span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">xb</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">arch</span><span class="p">(),</span> <span class="n">data</span><span class="p">,</span> <span class="n">loss_func</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cb_funcs</span><span class="o">=</span><span class="n">cbfs</span><span class="p">,</span> <span class="n">opt_func</span><span class="o">=</span><span class="n">opt_func</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/home/cedric/.conda/envs/fastai/lib/python3.6/site-packages/ipykernel_launcher.py:5: UserWarning: nn.init.constant is now deprecated in favor of nn.init.constant_.
  """
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse</span>
<span class="n">learn</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
<span class="n">model_summary</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">print_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>train_accuracy</th>
      <th>valid_loss</th>
      <th>valid_accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre> torch.Size([128, 32, 64, 64])
 torch.Size([128, 64, 64, 64])
 torch.Size([128, 64, 64, 64])
 torch.Size([128, 64, 32, 32])
 torch.Size([128, 64, 32, 32])
 torch.Size([128, 128, 16, 16])
 torch.Size([128, 256, 8, 8])
 torch.Size([128, 512, 4, 4])
 torch.Size([128, 512, 1, 1])
 torch.Size([128, 512])
 torch.Size([128, 10])
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse</span>
<span class="n">arch</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">xresnet34</span><span class="p">,</span> <span class="n">c_out</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">arch</span><span class="p">(),</span> <span class="n">data</span><span class="p">,</span> <span class="n">loss_func</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cb_funcs</span><span class="o">=</span><span class="n">cbfs</span><span class="p">,</span> <span class="n">opt_func</span><span class="o">=</span><span class="n">opt_func</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/home/cedric/.conda/envs/fastai/lib/python3.6/site-packages/ipykernel_launcher.py:5: UserWarning: nn.init.constant is now deprecated in favor of nn.init.constant_.
  """
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="p">[</span><span class="n">LR_Find</span><span class="p">(),</span> <span class="n">Recorder</span><span class="p">()])</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

    <div>
        <style>
            /* Turns off some styling */
            progress {
                /* gets rid of default border in Firefox and Opera. */
                border: none;
                /* Needs to be in here for Safari polyfill so background images work as expected. */
                background-size: auto;
            }
            .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
                background: #F44336;
            }
        </style>
      &lt;progress value='0' class='' max='1', style='width:300px; height:20px; vertical-align: middle;'&gt;&lt;/progress&gt;
      
    </div>
    

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>train_accuracy</th>
      <th>valid_loss</th>
      <th>valid_accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse</span>
<span class="n">learn</span><span class="o">.</span><span class="n">recorder</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_show</span>
<span class="k">def</span> <span class="nf">create_phases</span><span class="p">(</span><span class="n">phases</span><span class="p">):</span>
    <span class="n">phases</span> <span class="o">=</span> <span class="n">listify</span><span class="p">(</span><span class="n">phases</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">phases</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">phases</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_show</span>
<span class="nb">print</span><span class="p">(</span><span class="n">create_phases</span><span class="p">(</span><span class="mf">0.3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">create_phases</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.2</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[0.3, 0.7]
[0.3, 0.2, 0.5]
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_show</span>
<span class="n">lr</span> <span class="o">=</span> <span class="mf">1e-2</span>
<span class="n">pct_start</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">phases</span> <span class="o">=</span> <span class="n">create_phases</span><span class="p">(</span><span class="n">pct_start</span><span class="p">)</span>
<span class="n">sched_lr</span>  <span class="o">=</span> <span class="n">combine_scheds</span><span class="p">(</span><span class="n">phases</span><span class="p">,</span> <span class="n">cos_1cycle_anneal</span><span class="p">(</span><span class="n">lr</span><span class="o">/</span><span class="mf">10.</span><span class="p">,</span> <span class="n">lr</span><span class="p">,</span> <span class="n">lr</span><span class="o">/</span><span class="mf">1e5</span><span class="p">))</span>
<span class="n">sched_mom</span> <span class="o">=</span> <span class="n">combine_scheds</span><span class="p">(</span><span class="n">phases</span><span class="p">,</span> <span class="n">cos_1cycle_anneal</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_show</span>
<span class="n">cbsched</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ParamScheduler</span><span class="p">(</span><span class="s1">'lr'</span><span class="p">,</span> <span class="n">sched_lr</span><span class="p">),</span>
    <span class="n">ParamScheduler</span><span class="p">(</span><span class="s1">'mom'</span><span class="p">,</span> <span class="n">sched_mom</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_show</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">arch</span><span class="p">(),</span> <span class="n">data</span><span class="p">,</span> <span class="n">loss_func</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">cb_funcs</span><span class="o">=</span><span class="n">cbfs</span><span class="p">,</span> <span class="n">opt_func</span><span class="o">=</span><span class="n">opt_func</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/home/cedric/.conda/envs/fastai/lib/python3.6/site-packages/ipykernel_launcher.py:5: UserWarning: nn.init.constant is now deprecated in favor of nn.init.constant_.
  """
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_show</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="n">cbsched</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

    <div>
        <style>
            /* Turns off some styling */
            progress {
                /* gets rid of default border in Firefox and Opera. */
                border: none;
                /* Needs to be in here for Safari polyfill so background images work as expected. */
                background-size: auto;
            }
            .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
                background: #F44336;
            }
        </style>
      &lt;progress value='0' class='' max='5', style='width:300px; height:20px; vertical-align: middle;'&gt;&lt;/progress&gt;
      
    </div>
    

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>train_accuracy</th>
      <th>valid_loss</th>
      <th>valid_accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.747138</td>
      <td>0.461189</td>
      <td>2.137488</td>
      <td>0.448408</td>
      <td>00:20</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1.530650</td>
      <td>0.573239</td>
      <td>1.779503</td>
      <td>0.470064</td>
      <td>00:20</td>
    </tr>
    <tr>
      <td>2</td>
      <td>1.386309</td>
      <td>0.634280</td>
      <td>1.324897</td>
      <td>0.672357</td>
      <td>00:20</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1.207779</td>
      <td>0.713275</td>
      <td>1.158664</td>
      <td>0.729172</td>
      <td>00:20</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1.045097</td>
      <td>0.778435</td>
      <td>0.997302</td>
      <td>0.799745</td>
      <td>00:20</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="cnn_learner">
<a class="anchor" href="#cnn_learner" aria-hidden="true"><span class="octicon octicon-link"></span></a>cnn_learner<a class="anchor-link" href="#cnn_learner"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://course.fast.ai/videos/?lesson=12&amp;t=2711">Jump_to lesson 12 video</a></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_show</span>
<span class="k">def</span> <span class="nf">cnn_learner</span><span class="p">(</span><span class="n">arch</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">loss_func</span><span class="p">,</span> <span class="n">opt_func</span><span class="p">,</span> <span class="n">c_in</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">c_out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">lr</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span> <span class="n">cuda</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mixup</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xtra_cb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">cbfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">partial</span><span class="p">(</span><span class="n">AvgStatsCallback</span><span class="p">,</span><span class="n">accuracy</span><span class="p">)]</span><span class="o">+</span><span class="n">listify</span><span class="p">(</span><span class="n">xtra_cb</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">progress</span><span class="p">:</span> <span class="n">cbfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ProgressCallback</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cuda</span><span class="p">:</span>     <span class="n">cbfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CudaCallback</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>     <span class="n">cbfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">BatchTransformXCallback</span><span class="p">,</span> <span class="n">norm</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">mixup</span><span class="p">:</span>    <span class="n">cbfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">MixUp</span><span class="p">,</span> <span class="n">mixup</span><span class="p">))</span>
    <span class="n">arch_args</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">c_in</span> <span class="p">:</span> <span class="n">c_in</span>  <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">c_in</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">c_out</span><span class="p">:</span> <span class="n">c_out</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">c_out</span>
    <span class="k">if</span> <span class="n">c_in</span><span class="p">:</span>  <span class="n">arch_args</span><span class="p">[</span><span class="s1">'c_in'</span> <span class="p">]</span><span class="o">=</span><span class="n">c_in</span>
    <span class="k">if</span> <span class="n">c_out</span><span class="p">:</span> <span class="n">arch_args</span><span class="p">[</span><span class="s1">'c_out'</span><span class="p">]</span><span class="o">=</span><span class="n">c_out</span>
    <span class="k">return</span> <span class="n">Learner</span><span class="p">(</span><span class="n">arch</span><span class="p">(</span><span class="o">**</span><span class="n">arch_args</span><span class="p">),</span> <span class="n">data</span><span class="p">,</span> <span class="n">loss_func</span><span class="p">,</span> <span class="n">opt_func</span><span class="o">=</span><span class="n">opt_func</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">cb_funcs</span><span class="o">=</span><span class="n">cbfs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_show</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">cnn_learner</span><span class="p">(</span><span class="n">xresnet34</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">loss_func</span><span class="p">,</span> <span class="n">opt_func</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm_imagenette</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_show</span>

<span class="n">learn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">cbsched</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

    <div>
        <style>
            /* Turns off some styling */
            progress {
                /* gets rid of default border in Firefox and Opera. */
                border: none;
                /* Needs to be in here for Safari polyfill so background images work as expected. */
                background-size: auto;
            }
            .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
                background: #F44336;
            }
        </style>
      &lt;progress value='0' class='' max='5', style='width:300px; height:20px; vertical-align: middle;'&gt;&lt;/progress&gt;
      
    </div>
    

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>train_accuracy</th>
      <th>valid_loss</th>
      <th>valid_accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.734203</td>
      <td>0.474813</td>
      <td>1.960827</td>
      <td>0.469299</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1.525025</td>
      <td>0.574506</td>
      <td>2.046430</td>
      <td>0.447643</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>1.396191</td>
      <td>0.626888</td>
      <td>1.789930</td>
      <td>0.493248</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1.216749</td>
      <td>0.706833</td>
      <td>1.156404</td>
      <td>0.729427</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1.043234</td>
      <td>0.776956</td>
      <td>1.005148</td>
      <td>0.792102</td>
      <td>00:18</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Imagenet">
<a class="anchor" href="#Imagenet" aria-hidden="true"><span class="octicon octicon-link"></span></a>Imagenet<a class="anchor-link" href="#Imagenet"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can see all this put together in the fastai <a href="https://github.com/fastai/fastai/blob/master/examples/train_imagenet.py">imagenet training script</a>. It's the same as what we've seen so far, except it also handles multi-GPU training. So how well does this work?</p>
<p>We trained for 60 epochs, and got an error of 5.9%, compared to the official PyTorch resnet which gets 7.5% error in 90 epochs! Our xresnet 50 training even surpasses standard resnet 152, which trains for 50% more epochs and has 3x as many layers.</p>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="Cedric-Perauer/DL_from_Foundations"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/DL_from_Foundations/jupyter/2020/04/21/4trainimagenette.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/DL_from_Foundations/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/DL_from_Foundations/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/DL_from_Foundations/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>An easy to use blogging platform with support for Jupyter Notebooks.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/Cedric-Perauer" title="Cedric-Perauer"><svg class="svg-icon grey"><use xlink:href="/DL_from_Foundations/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/fastdotai" title="fastdotai"><svg class="svg-icon grey"><use xlink:href="/DL_from_Foundations/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
